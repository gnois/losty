
-- temporarily sets the req.next()

return \handlers, req, res ->
	var i, n = 0, #handlers
	var args, a = {}, 0

	var nxt = req.next
	req.next = \... ->
		for _, v in ipairs({...})
			a = a + 1
			args[a] = v
		i = i + 1
		if i <= n
			-- unpack() accepts tables of up to 8000 elements in Lua 5.1 and LuaJIT
			return handlers[i](req, res, unpack(args))

	var v = req.next()
	req.next = nxt
	return v
